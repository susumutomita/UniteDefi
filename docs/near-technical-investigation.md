# NEAR Protocol æŠ€è¡“èª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆ

## ğŸ¯ é‡è¦ãªå‰æï¼šNEARã§ã¯Solidityã¯å‹•ä½œã—ã¾ã›ã‚“

NEARã¯ç‹¬è‡ªã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’æŒã¤ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ã‚¤ãƒ³ã§ã€Ethereum Virtual Machine (EVM) ã¨ã¯ç•°ãªã‚‹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã™ã€‚

### NEAR vs Ethereum ã®æ ¹æœ¬çš„ãªé•ã„

| é …ç›® | Ethereum | NEAR |
|------|----------|------|
| ä»®æƒ³ãƒã‚·ãƒ³ | EVM | NEAR Runtime (WebAssembly) |
| ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆè¨€èª | Solidity | Rust, AssemblyScript |
| ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¢ãƒ‡ãƒ« | ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ™ãƒ¼ã‚¹ | äººé–“ãŒèª­ã‚ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID |
| ã‚¬ã‚¹ä»£æ”¯æ‰•ã„ | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ”¯æ‰•ã† | ãƒ¡ã‚¿ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¯èƒ½ |
| ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚³ã‚¹ãƒˆ | ã‚¬ã‚¹ä»£ã«å«ã¾ã‚Œã‚‹ | åˆ¥é€”ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¹ãƒ†ãƒ¼ã‚­ãƒ³ã‚°ãŒå¿…è¦ |

## ğŸ”§ NEARã§ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’æ›¸ãæ–¹æ³•

### 1. é–‹ç™ºè¨€èªã®é¸æŠ

NEARã§ã¯2ã¤ã®è¨€èªãŒé¸æŠå¯èƒ½ã€‚

#### Rustï¼ˆæ¨å¥¨ï¼‰
- é«˜æ€§èƒ½
- å‹å®‰å…¨æ€§
- ã‚ˆã‚Šå¤šãã®æ©Ÿèƒ½ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒå‘ã‘

```rust
use near_sdk::{near_bindgen, env};

#[near_bindgen]
pub struct Contract {
    value: String,
}

#[near_bindgen]
impl Contract {
    pub fn get_value(&self) -> String {
        self.value.clone()
    }
}
```

#### AssemblyScript
- TypeScriptã«ä¼¼ãŸæ§‹æ–‡
- å­¦ç¿’æ›²ç·šãŒç·©ã‚„ã‹
- ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ”ãƒ³ã‚°å‘ã‘

### 2. NEARã®åŸºæœ¬æ¦‚å¿µ

#### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- ä¾‹ï¼š`alice.near`ã€`contract.alice.near`
- ã‚µãƒ–ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆãŒå¯èƒ½
- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè‡ªä½“ãŒã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ãƒ›ã‚¹ãƒˆã§ãã‚‹

#### ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¹ãƒ†ãƒ¼ã‚­ãƒ³ã‚°
- ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã«ã¯NEARãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒ­ãƒƒã‚¯ãŒå¿…è¦
- 1ãƒã‚¤ãƒˆã‚ãŸã‚Šç´„0.00001 NEAR

#### ãƒ¡ã‚½ãƒƒãƒ‰ã®ç¨®é¡
- viewãƒ¡ã‚½ãƒƒãƒ‰: çŠ¶æ…‹ã‚’èª­ã‚€ã ã‘ï¼ˆç„¡æ–™ï¼‰
- changeãƒ¡ã‚½ãƒƒãƒ‰: çŠ¶æ…‹ã‚’å¤‰æ›´ï¼ˆã‚¬ã‚¹ä»£å¿…è¦ï¼‰

## ğŸ” HTLCã‚¨ã‚¹ã‚¯ãƒ­ãƒ¼å®Ÿè£…ã«å¿…è¦ãªè¦ç´ 

### 1. ã‚¿ã‚¤ãƒ ãƒ­ãƒƒã‚¯æ©Ÿèƒ½
```rust
pub struct Timelock {
    pub deployment_time: u64,      // ãƒŠãƒç§’å˜ä½ã®UNIXã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
    pub finality_lock: u64,        // ãƒ•ã‚¡ã‚¤ãƒŠãƒªãƒ†ã‚£ãƒ­ãƒƒã‚¯æœŸé–“
    pub resolver_unlock: u64,      // ãƒªã‚¾ãƒ«ãƒãƒ¼å°‚ç”¨æœŸé–“
    pub anybody_unlock: u64,       // èª°ã§ã‚‚å®Ÿè¡Œå¯èƒ½æœŸé–“
    pub resolver_cancel: u64,      // ãƒªã‚¾ãƒ«ãƒãƒ¼ã‚­ãƒ£ãƒ³ã‚»ãƒ«æœŸé–“
}
```

### 2. ãƒãƒƒã‚·ãƒ¥ãƒ­ãƒƒã‚¯æ©Ÿèƒ½
```rust
use sha2::{Sha256, Digest};

fn verify_secret(secret: &str, hash: &str) -> bool {
    let mut hasher = Sha256::new();
    hasher.update(secret.as_bytes());
    let result = hasher.finalize();
    let computed_hash = hex::encode(result);
    computed_hash == hash
}
```

### 3. ã‚¯ãƒ­ã‚¹ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚³ãƒ¼ãƒ«
NEARã§ã¯`Promise`ã‚’ä½¿ç”¨ã—ã¦ä»–ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’å‘¼ã³å‡ºã™ã€‚
```rust
use near_sdk::Promise;

// NEARãƒˆãƒ¼ã‚¯ãƒ³ã®è»¢é€
Promise::new(recipient).transfer(amount);

// NEP-141ãƒˆãƒ¼ã‚¯ãƒ³ã®è»¢é€
Promise::new(token_contract)
    .function_call(
        "ft_transfer",
        json!({
            "receiver_id": recipient,
            "amount": amount.to_string(),
        }).to_string().as_bytes(),
        1, // 1 yoctoNEAR
        5_000_000_000_000, // 5 TGas
    );
```

### 4. ã‚»ãƒ¼ãƒ•ãƒ†ã‚£ãƒ‡ãƒã‚¸ãƒƒãƒˆ
```rust
pub struct Escrow {
    pub safety_deposit: Balance,  // ãƒªã‚¾ãƒ«ãƒãƒ¼ãŒé ã‘ã‚‹ãƒ‡ãƒã‚¸ãƒƒãƒˆ
    pub safety_deposit_beneficiary: Option<AccountId>, // ç²å¾—è€…
}
```

## ğŸ“‹ 1inch Fusion+ NEARå®Ÿè£…ã®ãŸã‚ã®è¦ä»¶

### å¿…é ˆæ©Ÿèƒ½
1. ã‚¨ã‚¹ã‚¯ãƒ­ãƒ¼ä½œæˆ
   - ãƒªã‚¾ãƒ«ãƒãƒ¼ãŒNEARãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ­ãƒƒã‚¯
   - ãƒãƒƒã‚·ãƒ¥ãƒ­ãƒƒã‚¯ã¨ã‚¿ã‚¤ãƒ ãƒ­ãƒƒã‚¯ã®è¨­å®š
   - ã‚»ãƒ¼ãƒ•ãƒ†ã‚£ãƒ‡ãƒã‚¸ãƒƒãƒˆã®å—ã‘å–ã‚Š

2. ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæ¤œè¨¼ã¨å¼•ãå‡ºã—
   - æ­£ã—ã„ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®æ¤œè¨¼
   - ã‚¿ã‚¤ãƒ ãƒ­ãƒƒã‚¯æœŸé–“ã®ãƒã‚§ãƒƒã‚¯
   - å—å–äººã¸ã®é€é‡‘

3. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†
   - å„æœŸé–“ã§ã®æ¨©é™ãƒã‚§ãƒƒã‚¯
   - ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ©Ÿèƒ½
   - è¿”é‡‘å‡¦ç†

### NEARã®åˆ¶ç´„äº‹é …
1. éåŒæœŸå®Ÿè¡Œ
   - ã‚¯ãƒ­ã‚¹ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚³ãƒ¼ãƒ«ã¯éåŒæœŸ
   - ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä½¿ç”¨ãŒå¿…è¦

2. ã‚¬ã‚¹ãƒªãƒŸãƒƒãƒˆ
   - 1ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚ãŸã‚Šæœ€å¤§300 TGas
   - è¤‡é›‘ãªå‡¦ç†ã¯åˆ†å‰²ãŒå¿…è¦

3. ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†
   - ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã«ã¯ãƒ‡ãƒã‚¸ãƒƒãƒˆãŒå¿…è¦
   - ä¸è¦ã«ãªã£ãŸãƒ‡ãƒ¼ã‚¿ã¯å‰Šé™¤ã—ã¦ãƒ‡ãƒã‚¸ãƒƒãƒˆã‚’å›å

## ğŸ›  é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. å¿…è¦ãªãƒ„ãƒ¼ãƒ«
```bash
# Rustã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# NEAR CLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install -g near-cli

# WebAssemblyã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®è¿½åŠ 
rustup target add wasm32-unknown-unknown
```

### 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 
```
contracts/near-htlc/
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib.rs          # ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ
â”‚   â”œâ”€â”€ escrow.rs       # ã‚¨ã‚¹ã‚¯ãƒ­ãƒ¼æ§‹é€ ä½“
â”‚   â”œâ”€â”€ timelock.rs     # ã‚¿ã‚¤ãƒ ãƒ­ãƒƒã‚¯ç®¡ç†
â”‚   â””â”€â”€ tests/          # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ build.sh            # ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â””â”€â”€ deploy.sh           # ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```

### 3. ãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
```bash
# ãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
near create-account htlc.testnet --useFaucet

# ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤
near deploy --accountId htlc.testnet --wasmFile target/wasm32-unknown-unknown/release/near_htlc.wasm
```

## ğŸ“š å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [NEAR Documentation](https://docs.near.org/)
- [NEAR SDK-RS](https://docs.rs/near-sdk/latest/near_sdk/)
- [NEAR Examples](https://github.com/near-examples)

### HTLCã®å‚è€ƒå®Ÿè£…
- [Atomic Swaps on NEAR](https://github.com/near/near-atomic-swap)
- [Rainbow Bridge](https://github.com/aurora-is-near/rainbow-bridge) - NEARã¨Ethereumã®ãƒ–ãƒªãƒƒã‚¸

### é–‹ç™ºãƒ„ãƒ¼ãƒ«
- [NEAR Explorer](https://explorer.testnet.near.org/) - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç¢ºèª
- [NEAR Wallet](https://wallet.testnet.near.org/) - ãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆã‚¦ã‚©ãƒ¬ãƒƒãƒˆ
- [near-api-js](https://github.com/near/near-api-js) - JavaScript SDK

## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. Rustç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
   - Rustã¨near-cliã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
   - ãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆ

2. HTLCã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®è¨­è¨ˆ
   - 1inch Fusion+ã®ä»•æ§˜ã«åˆã‚ã›ãŸå®Ÿè£…
   - ã‚¿ã‚¤ãƒ ãƒ­ãƒƒã‚¯æœŸé–“ã®èª¿æ•´

3. ãƒ†ã‚¹ãƒˆã¨ãƒ‡ãƒãƒƒã‚°
   - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ä½œæˆ
   - ãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆã§ã®å‹•ä½œç¢ºèª

4. CLIãƒ„ãƒ¼ãƒ«ã®å®Ÿè£…
   - ã‚¯ãƒ­ã‚¹ãƒã‚§ã‚¤ãƒ³ã‚¹ãƒ¯ãƒƒãƒ—ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
   - Ethereumã¨ã®é€£æº

## âš ï¸ é‡è¦ãªæ³¨æ„ç‚¹

1. NEARã¯EVMãƒã‚§ã‚¤ãƒ³ã§ã¯ãªã„
   - Solidityã‚³ãƒ¼ãƒ‰ã¯å‹•ä½œã—ãªã„
   - ç‹¬è‡ªã®ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆé–‹ç™ºãŒå¿…è¦

2. éåŒæœŸå‡¦ç†ã®ç†è§£ãŒå¿…é ˆ
   - Promiseãƒ™ãƒ¼ã‚¹ã®è¨­è¨ˆ
   - ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³

3. ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚³ã‚¹ãƒˆã®è€ƒæ…®
   - ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã«ã¯NEARã®ãƒ­ãƒƒã‚¯ãŒå¿…è¦
   - ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®è¨­è¨ˆãŒé‡è¦

ã“ã®èª¿æŸ»ã«åŸºã¥ã„ã¦ã€NEARå´ã®HTLCã‚¨ã‚¹ã‚¯ãƒ­ãƒ¼ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚
